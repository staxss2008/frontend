import{_ as fe,u as _e,r as c,h as be,b as p,i as ge,o as E,c as A,d as e,w as a,E as v,e as C,g as n,m as we,n as P,t as u,F as B,k as F,q as ye}from"./main-5d00e0ed.js";import{g as Ee,r as Ve,a as Ne,b as Ce,d as he,e as De,f as Ie,h as Se}from"./application-e8a4b6ce.js";const Re={class:"application-list"},Ae={class:"card-header"},Pe={class:"dialog-footer"},Te={class:"dialog-footer"},ke={__name:"List",setup(xe){const M=_e(),h=c(!1),T=c([]),k=c(0),r=c(null),D=c(!1),V=c(!1),N=c(!1),s=c({}),y=c({reason:""}),_=c({vehicleId:null,driverId:null,dispatcherId:1}),x=c([]),L=c([]),i=c({page:1,size:10,status:void 0}),g=async()=>{h.value=!0;try{const t=await Ee(i.value.page,i.value.size,i.value.status);T.value=t.data.list,k.value=t.data.total}catch(t){console.error(t),v.error("获取申请列表失败")}finally{h.value=!1}},z=()=>{i.value.page=1,g()},$=()=>{i.value={page:1,size:10,status:void 0},z()},q=t=>{i.value.size=t,g()},J=t=>{i.value.page=t,g()},Q=()=>{M.push("/application/create")},H=async t=>{try{const l=await he(t.id);s.value=l.data,D.value=!0}catch(l){console.error(l),v.error("获取申请详情失败")}},K=async t=>{s.value=t,_.value.vehicleId=null,_.value.driverId=null,await Promise.all([Z(),ee()]),N.value=!0},W=t=>{s.value=t,y.value.reason="",V.value=!0},X=async()=>{if(!y.value.reason.trim()){v.warning("请输入拒绝理由");return}try{await Ve(s.value.id,{remark:y.value.reason}),v.success("申请已拒绝"),V.value=!1,g()}catch(t){console.error(t),v.error("拒绝申请失败")}},Y=async t=>{try{await ye.confirm("确认完成该申请吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De(t.id),v.success("申请已完成"),g()}catch(l){l!=="cancel"&&(console.error(l),v.error("完成申请失败"))}},Z=async()=>{try{const t=await Ie();x.value=t.data}catch(t){console.error(t),v.error("获取车辆列表失败")}},ee=async()=>{try{const t=await Se();L.value=t.data}catch(t){console.error(t),v.error("获取驾驶员列表失败")}},le=async()=>{if(!_.value.vehicleId){v.warning("请选择车辆");return}if(!_.value.driverId){v.warning("请选择驾驶员");return}try{await Ne(s.value.id,{remark:"批准并指派车辆"}),await Ce(s.value.id,_.value),v.success("批准并指派车辆成功"),N.value=!1,g()}catch(t){console.error(t),v.error("操作失败")}},G=t=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger",COMPLETED:"info",ASSIGNED:"primary",IN_PROGRESS:"primary"})[t]||"info",O=t=>({PENDING:"待审批",APPROVED:"已批准",REJECTED:"已拒绝",COMPLETED:"已完成",ASSIGNED:"已指派",IN_PROGRESS:"进行中"})[t]||"未知",U=t=>({OFFICIAL:"公务用车",TRANSPORT:"通勤用车",RECEIVE:"接待用车"})[t]||"未知",ae=t=>{if(!t)return"无";try{const l=JSON.parse(t);return l.reason?l.reason:l.remark?l.remark:t}catch{return t}},te=t=>{r.value=t},oe=({row:t})=>r.value&&r.value.id===t.id?"selected-row":"",ne=()=>{r.value&&H(r.value)},se=()=>{r.value&&K(r.value)},re=()=>{r.value&&W(r.value)},ue=()=>{r.value&&Y(r.value)};return be(()=>{g()}),(t,l)=>{const f=p("el-button"),b=p("el-option"),I=p("el-select"),w=p("el-form-item"),S=p("el-form"),d=p("el-table-column"),j=p("el-tag"),ie=p("el-table"),de=p("el-pagination"),pe=p("el-card"),m=p("el-descriptions-item"),ce=p("el-descriptions"),R=p("el-dialog"),ve=p("el-input"),me=ge("loading");return E(),A("div",Re,[e(pe,null,{header:a(()=>[C("div",Ae,[l[12]||(l[12]=C("h3",null,"用车申请列表",-1)),e(f,{type:"primary",onClick:Q},{default:a(()=>[...l[11]||(l[11]=[n("新建申请",-1)])]),_:1})])]),default:a(()=>[e(S,{model:i.value,inline:""},{default:a(()=>[e(w,{label:"申请状态"},{default:a(()=>[e(I,{modelValue:i.value.status,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value.status=o),placeholder:"请选择状态",clearable:""},{default:a(()=>[e(b,{label:"待审批",value:"PENDING"}),e(b,{label:"已批准",value:"APPROVED"}),e(b,{label:"已拒绝",value:"REJECTED"}),e(b,{label:"已指派",value:"ASSIGNED"}),e(b,{label:"进行中",value:"IN_PROGRESS"}),e(b,{label:"已完成",value:"COMPLETED"})]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:a(()=>[e(f,{type:"primary",onClick:z},{default:a(()=>[...l[13]||(l[13]=[n("搜索",-1)])]),_:1}),e(f,{onClick:$},{default:a(()=>[...l[14]||(l[14]=[n("重置",-1)])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(f,{type:"primary",onClick:ne,disabled:!r.value},{default:a(()=>[...l[15]||(l[15]=[n(" 查看 ",-1)])]),_:1},8,["disabled"]),e(f,{type:"success",onClick:se,disabled:!r.value||r.value.status!=="PENDING"},{default:a(()=>[...l[16]||(l[16]=[n(" 批准并指派 ",-1)])]),_:1},8,["disabled"]),e(f,{type:"danger",onClick:re,disabled:!r.value||r.value.status!=="PENDING"},{default:a(()=>[...l[17]||(l[17]=[n(" 拒绝 ",-1)])]),_:1},8,["disabled"]),e(f,{type:"success",onClick:ue,disabled:!r.value||r.value.status!=="ASSIGNED"&&r.value.status!=="IN_PROGRESS"},{default:a(()=>[...l[18]||(l[18]=[n(" 完成 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),we((E(),P(ie,{data:T.value,style:{width:"100%"},onRowClick:te,"row-class-name":oe},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(o=>[e(j,{type:G(o.row.status)},{default:a(()=>[n(u(O(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"applicationNo",label:"申请单号",width:"150"}),e(d,{prop:"applicantName",label:"申请人",width:"100"}),e(d,{prop:"vehiclePlateNo",label:"车辆",width:"120"},{default:a(o=>[n(u(o.row.vehiclePlateNo||"未指派"),1)]),_:1}),e(d,{prop:"driverName",label:"驾驶人",width:"100"},{default:a(o=>[n(u(o.row.driverName||"未指派"),1)]),_:1}),e(d,{prop:"departmentName",label:"部门",width:"120"}),e(d,{prop:"tripType",label:"用车类型",width:"100"},{default:a(o=>[n(u(U(o.row.tripType)),1)]),_:1}),e(d,{prop:"purpose",label:"用车事由",width:"150","show-overflow-tooltip":""}),e(d,{prop:"passengerCount",label:"乘车人数",width:"100"}),e(d,{prop:"startTime",label:"开始时间",width:"160"}),e(d,{prop:"endTime",label:"结束时间",width:"160"}),e(d,{prop:"startLocation",label:"出发地",width:"120","show-overflow-tooltip":""}),e(d,{prop:"endLocation",label:"目的地",width:"120","show-overflow-tooltip":""})]),_:1},8,["data"])),[[me,h.value]]),e(de,{"current-page":i.value.page,"onUpdate:currentPage":l[1]||(l[1]=o=>i.value.page=o),"page-size":i.value.size,"onUpdate:pageSize":l[2]||(l[2]=o=>i.value.size=o),"page-sizes":[10,20,50,100],total:k.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:J,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"])]),_:1}),e(R,{title:"申请详情",modelValue:D.value,"onUpdate:modelValue":l[3]||(l[3]=o=>D.value=o),width:"600px"},{default:a(()=>[e(ce,{column:1,border:""},{default:a(()=>[e(m,{label:"申请单号"},{default:a(()=>[n(u(s.value.applicationNo),1)]),_:1}),e(m,{label:"申请人"},{default:a(()=>[n(u(s.value.applicantName),1)]),_:1}),e(m,{label:"部门"},{default:a(()=>[n(u(s.value.departmentName),1)]),_:1}),e(m,{label:"用车类型"},{default:a(()=>[n(u(U(s.value.tripType)),1)]),_:1}),e(m,{label:"用车事由"},{default:a(()=>[n(u(s.value.purpose),1)]),_:1}),e(m,{label:"乘车人数"},{default:a(()=>[n(u(s.value.passengerCount),1)]),_:1}),e(m,{label:"开始时间"},{default:a(()=>[n(u(s.value.startTime),1)]),_:1}),e(m,{label:"结束时间"},{default:a(()=>[n(u(s.value.endTime),1)]),_:1}),e(m,{label:"出发地点"},{default:a(()=>[n(u(s.value.startLocation),1)]),_:1}),e(m,{label:"目的地"},{default:a(()=>[n(u(s.value.endLocation),1)]),_:1}),e(m,{label:"状态"},{default:a(()=>[e(j,{type:G(s.value.status)},{default:a(()=>[n(u(O(s.value.status)),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"备注"},{default:a(()=>[n(u(ae(s.value.remark)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{title:"拒绝理由",modelValue:V.value,"onUpdate:modelValue":l[6]||(l[6]=o=>V.value=o),width:"500px"},{footer:a(()=>[C("div",Pe,[e(f,{onClick:l[5]||(l[5]=o=>V.value=!1)},{default:a(()=>[...l[19]||(l[19]=[n("取 消",-1)])]),_:1}),e(f,{type:"primary",onClick:X},{default:a(()=>[...l[20]||(l[20]=[n("确 定",-1)])]),_:1})])]),default:a(()=>[e(S,{model:y.value,"label-width":"80px"},{default:a(()=>[e(w,{label:"拒绝理由"},{default:a(()=>[e(ve,{modelValue:y.value.reason,"onUpdate:modelValue":l[4]||(l[4]=o=>y.value.reason=o),type:"textarea",rows:4,placeholder:"请输入拒绝理由"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(R,{title:"批准并指派车辆",modelValue:N.value,"onUpdate:modelValue":l[10]||(l[10]=o=>N.value=o),width:"600px"},{footer:a(()=>[C("div",Te,[e(f,{onClick:l[9]||(l[9]=o=>N.value=!1)},{default:a(()=>[...l[21]||(l[21]=[n("取 消",-1)])]),_:1}),e(f,{type:"primary",onClick:le},{default:a(()=>[...l[22]||(l[22]=[n("确 定",-1)])]),_:1})])]),default:a(()=>[e(S,{model:_.value,"label-width":"100px"},{default:a(()=>[e(w,{label:"申请单号"},{default:a(()=>[C("span",null,u(s.value.applicationNo),1)]),_:1}),e(w,{label:"车辆",required:""},{default:a(()=>[e(I,{modelValue:_.value.vehicleId,"onUpdate:modelValue":l[7]||(l[7]=o=>_.value.vehicleId=o),placeholder:"请选择车辆",style:{width:"100%"},filterable:""},{default:a(()=>[(E(!0),A(B,null,F(x.value,o=>(E(),P(b,{key:o.id,label:`${o.plateNo} - ${o.brand} ${o.model}`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"驾驶员",required:""},{default:a(()=>[e(I,{modelValue:_.value.driverId,"onUpdate:modelValue":l[8]||(l[8]=o=>_.value.driverId=o),placeholder:"请选择驾驶员",style:{width:"100%"},filterable:""},{default:a(()=>[(E(!0),A(B,null,F(L.value,o=>(E(),P(b,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ge=fe(ke,[["__scopeId","data-v-c5811c13"]]);export{Ge as default};
