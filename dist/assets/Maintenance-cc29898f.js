import{g as me,u as ve,c as ce,d as B}from"./maintenance-5224a0da.js";import{g as fe}from"./vehicle-30f80322.js";import{_ as ge,r as i,h as _e,b as d,i as ye,o as y,c as h,d as l,w as o,E as g,e as k,g as m,F as D,k as R,m as be,n as T,t as L,q as F}from"./main-5d00e0ed.js";const Ne={class:"vehicle-maintenance"},Ve={class:"card-header"},we={class:"dialog-footer"},Ce={__name:"Maintenance",setup(Ie){const V=i(!1),S=i([]),w=i([]),x=i(0),_=i(!1),C=i(""),I=i(!1),s=i(null),u=i({page:1,size:10,vehicleId:void 0,type:void 0}),n=i({id:void 0,vehicleId:void 0,type:"",date:"",mileage:0,cost:0,content:"",provider:"",handler:"",remark:""}),O={vehicleId:[{required:!0,message:"请选择车辆",trigger:"change"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],date:[{required:!0,message:"请选择日期",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},E=i(null),q=async()=>{try{const t=await fe(1,1e3);w.value=t.data.list}catch(t){console.error(t),g.error("获取车辆列表失败")}},v=async()=>{V.value=!0;try{const t=await me(u.value.page,u.value.size,u.value.vehicleId,u.value.type);S.value=t.data.list,x.value=t.data.total}catch(t){console.error(t),g.error("获取维修保养记录失败")}finally{V.value=!1}},U=()=>{u.value.page=1,v()},P=()=>{u.value={page:1,size:10,vehicleId:void 0,type:void 0},U()},Y=t=>{u.value.size=t,v()},H=t=>{u.value.page=t,v()},Q=()=>{C.value="新增维修保养记录",I.value=!1,_.value=!0},$=t=>{C.value="编辑维修保养记录",I.value=!0,n.value={...t},_.value=!0},j=async t=>{try{await F.confirm("确定要删除该维修保养记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await B(t.id),g.success("删除成功"),v()}catch(e){e!=="cancel"&&g.error("删除失败")}},G=async t=>{try{await F.confirm(`确定要完成车辆 ${t.plateNo} 的维保吗？完成后车辆状态将恢复为空闲。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),await B(t.id),g.success("维保已完成，车辆状态已恢复为空闲"),v()}catch(e){e!=="cancel"&&g.error("操作失败")}},J=async()=>{await E.value.validate(t=>{t&&(I.value?ve(n.value.id,n.value).then(()=>{g.success("修改成功"),_.value=!1,v()}):ce(n.value).then(()=>{g.success("新增成功"),_.value=!1,v()}))})},K=()=>{var t;(t=E.value)==null||t.resetFields()},W=t=>({MAINTENANCE:"warning",INSPECTION:"success",INSURANCE:"info"})[t]||"info",X=t=>({MAINTENANCE:"维修",INSPECTION:"年检",INSURANCE:"保险"})[t]||"未知",Z=t=>({IDLE:"success",BUSY:"warning",OFFLINE:"info",MAINTENANCE:"danger"})[t]||"info",ee=t=>({IDLE:"空闲",BUSY:"使用中",OFFLINE:"离线",MAINTENANCE:"维修中"})[t]||"未知",le=t=>{s.value=t},ae=({row:t})=>s.value&&s.value.id===t.id?"selected-row":"",te=()=>{s.value&&$(s.value)},oe=()=>{s.value&&G(s.value)},ne=()=>{s.value&&j(s.value)};return _e(()=>{q(),v()}),(t,e)=>{const c=d("el-button"),f=d("el-option"),b=d("el-select"),r=d("el-form-item"),M=d("el-form"),p=d("el-table-column"),A=d("el-tag"),ue=d("el-table"),de=d("el-pagination"),re=d("el-card"),se=d("el-date-picker"),z=d("el-input-number"),N=d("el-input"),ie=d("el-dialog"),pe=ye("loading");return y(),h("div",Ne,[l(re,null,{header:o(()=>[k("div",Ve,[e[16]||(e[16]=k("h3",null,"车辆维修保养记录",-1)),l(c,{type:"primary",onClick:Q},{default:o(()=>[...e[15]||(e[15]=[m("新增记录",-1)])]),_:1})])]),default:o(()=>[l(M,{model:u.value,inline:""},{default:o(()=>[l(r,{label:"车辆"},{default:o(()=>[l(b,{modelValue:u.value.vehicleId,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.vehicleId=a),placeholder:"请选择车辆",clearable:"",filterable:""},{default:o(()=>[(y(!0),h(D,null,R(w.value,a=>(y(),T(f,{key:a.id,label:a.plateNo,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"类型"},{default:o(()=>[l(b,{modelValue:u.value.type,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.type=a),placeholder:"请选择类型",clearable:""},{default:o(()=>[l(f,{label:"维修",value:"MAINTENANCE"}),l(f,{label:"年检",value:"INSPECTION"}),l(f,{label:"保险",value:"INSURANCE"})]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:o(()=>[l(c,{type:"primary",onClick:U},{default:o(()=>[...e[17]||(e[17]=[m("搜索",-1)])]),_:1}),l(c,{onClick:P},{default:o(()=>[...e[18]||(e[18]=[m("重置",-1)])]),_:1})]),_:1}),l(r,null,{default:o(()=>[l(c,{type:"primary",onClick:te,disabled:!s.value},{default:o(()=>[...e[19]||(e[19]=[m(" 编辑 ",-1)])]),_:1},8,["disabled"]),l(c,{type:"success",onClick:oe,disabled:!s.value},{default:o(()=>[...e[20]||(e[20]=[m(" 完成维保 ",-1)])]),_:1},8,["disabled"]),l(c,{type:"danger",onClick:ne,disabled:!s.value},{default:o(()=>[...e[21]||(e[21]=[m(" 删除 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),be((y(),T(ue,{data:S.value,style:{width:"100%"},onRowClick:le,"row-class-name":ae},{default:o(()=>[l(p,{prop:"id",label:"ID",width:"80"}),l(p,{prop:"plateNo",label:"车牌号",width:"120"}),l(p,{prop:"vehicleStatus",label:"车辆状态",width:"100"},{default:o(a=>[l(A,{type:Z(a.row.vehicleStatus)},{default:o(()=>[m(L(ee(a.row.vehicleStatus)),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"type",label:"类型",width:"100"},{default:o(a=>[l(A,{type:W(a.row.type)},{default:o(()=>[m(L(X(a.row.type)),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"date",label:"日期",width:"160"}),l(p,{prop:"mileage",label:"里程(km)",width:"120"}),l(p,{prop:"cost",label:"费用(元)",width:"120"}),l(p,{prop:"content",label:"内容",width:"200","show-overflow-tooltip":""}),l(p,{prop:"provider",label:"服务商",width:"150","show-overflow-tooltip":""}),l(p,{prop:"handler",label:"负责人",width:"100"})]),_:1},8,["data"])),[[pe,V.value]]),l(de,{"current-page":u.value.page,"onUpdate:currentPage":e[2]||(e[2]=a=>u.value.page=a),"page-size":u.value.size,"onUpdate:pageSize":e[3]||(e[3]=a=>u.value.size=a),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:H,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"])]),_:1}),l(ie,{title:C.value,modelValue:_.value,"onUpdate:modelValue":e[14]||(e[14]=a=>_.value=a),width:"600px",onClose:K},{footer:o(()=>[k("div",we,[l(c,{onClick:e[13]||(e[13]=a=>_.value=!1)},{default:o(()=>[...e[22]||(e[22]=[m("取 消",-1)])]),_:1}),l(c,{type:"primary",onClick:J},{default:o(()=>[...e[23]||(e[23]=[m("确 定",-1)])]),_:1})])]),default:o(()=>[l(M,{model:n.value,rules:O,ref_key:"formRef",ref:E,"label-width":"100px"},{default:o(()=>[l(r,{label:"车辆",prop:"vehicleId"},{default:o(()=>[l(b,{modelValue:n.value.vehicleId,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.vehicleId=a),placeholder:"请选择车辆",filterable:""},{default:o(()=>[(y(!0),h(D,null,R(w.value,a=>(y(),T(f,{key:a.id,label:a.plateNo,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"类型",prop:"type"},{default:o(()=>[l(b,{modelValue:n.value.type,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.type=a),placeholder:"请选择类型"},{default:o(()=>[l(f,{label:"维修",value:"MAINTENANCE"}),l(f,{label:"年检",value:"INSPECTION"}),l(f,{label:"保险",value:"INSURANCE"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"日期",prop:"date"},{default:o(()=>[l(se,{modelValue:n.value.date,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.date=a),type:"datetime",placeholder:"选择日期时间","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1}),l(r,{label:"里程(km)"},{default:o(()=>[l(z,{modelValue:n.value.mileage,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.mileage=a),min:0,precision:0},null,8,["modelValue"])]),_:1}),l(r,{label:"费用(元)"},{default:o(()=>[l(z,{modelValue:n.value.cost,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.cost=a),min:0,precision:2},null,8,["modelValue"])]),_:1}),l(r,{label:"内容",prop:"content"},{default:o(()=>[l(N,{modelValue:n.value.content,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.content=a),type:"textarea",rows:3,placeholder:"请输入维修保养内容"},null,8,["modelValue"])]),_:1}),l(r,{label:"服务商"},{default:o(()=>[l(N,{modelValue:n.value.provider,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.provider=a),placeholder:"请输入服务商名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"负责人"},{default:o(()=>[l(N,{modelValue:n.value.handler,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.handler=a),placeholder:"请输入负责人"},null,8,["modelValue"])]),_:1}),l(r,{label:"备注"},{default:o(()=>[l(N,{modelValue:n.value.remark,"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.remark=a),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},Te=ge(Ce,[["__scopeId","data-v-4f12366e"]]);export{Te as default};
