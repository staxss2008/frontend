import{s as B,_ as P,r as v,h as G,z as H,A as X,b as c,i as q,o as b,c as V,d as e,w as s,e as a,j as C,t as h,g as E,m as D,p as J,n as K,B as Q,E as m,C as tt,D as et,G as st,H as at}from"./main-5d00e0ed.js";import{i as lt}from"./index-18acf776.js";function ot(){return B({url:"/api/vehicle/stats",method:"get"})}function nt(){return B({url:"/api/vehicle/list",method:"get",params:{page:1,size:100}})}function it(){return B({url:"/api/dispatch/real-time-location",method:"get"})}const ct={class:"dispatch-monitor"},dt={class:"stat-content"},rt={class:"stat-icon",style:{color:"#409EFF"}},ut={class:"stat-info"},pt={class:"stat-value"},_t={class:"stat-content"},ft={class:"stat-icon",style:{color:"#67C23A"}},vt={class:"stat-info"},ht={class:"stat-value"},mt={class:"stat-content"},gt={class:"stat-icon",style:{color:"#E6A23C"}},wt={class:"stat-info"},yt={class:"stat-value"},bt={class:"stat-content"},Ct={class:"stat-icon",style:{color:"#909399"}},Et={class:"stat-info"},Mt={class:"stat-value"},Nt={class:"card-header"},It={id:"vehicle-map",class:"map-container"},Vt={key:0,class:"map-placeholder"},Bt=Object.assign({name:"DispatchMonitor"},{__name:"Monitor",setup(Lt){const d=v({totalVehicles:0,idleVehicles:0,busyVehicles:0,offlineVehicles:0}),g=v([]),F=v(!1),S=v(!1),w=v(!1);let r=null;const z=l=>({IDLE:"success",BUSY:"warning",OFFLINE:"info",MAINTENANCE:"danger"})[l]||"info",M=l=>({IDLE:"空闲",BUSY:"使用中",OFFLINE:"离线",MAINTENANCE:"维修中"})[l]||"未知",O=l=>{console.log("点击车辆:",l)},T=l=>{m.success(`已选择车辆 ${l.plateNo} 进行派车`)},$=()=>{m.success("地图已刷新"),N()},U=()=>{m.success("已显示全部车辆"),o&&(o.setZoom(12),o.setCenter([116.397428,39.90923]))},N=async()=>{try{const l=await ot();d.value=l.data;const t=await nt(1,100);g.value=t.data.list;const i=await it();L(i.data),k()}catch(l){console.error("加载数据失败:",l),m.error("加载数据失败")}};let o=null;const W=()=>{if(typeof BMap<"u"){o=new BMap.Map("vehicle-map");const l=new BMap.Point(116.397428,39.90923);o.centerAndZoom(l,12),o.enableScrollWheelZoom(!0),o.addControl(new BMap.NavigationControl),o.addControl(new BMap.ScaleControl),w.value=!0}else setTimeout(()=>{w.value=!0,L(g.value.map(l=>({vehicleId:l.id,plateNo:l.plateNo,status:l.status,longitude:116.397428+(Math.random()-.5)*.1,latitude:39.90923+(Math.random()-.5)*.1})))},1e3)},L=l=>{w.value&&typeof BMap<"u"&&o&&(o.clearOverlays(),l.forEach(t=>{const i=new BMap.Point(t.longitude,t.latitude),n=new BMap.Marker(i);({IDLE:"#67C23A",BUSY:"#E6A23C",OFFLINE:"#909399",MAINTENANCE:"#F56C6C"})[t.status],n.addEventListener("click",()=>{const p=g.value.find(_=>_.id===t.vehicleId);p&&m.success(`车辆: ${p.plateNo}, 状态: ${M(p.status)}`)}),o.addOverlay(n);const u=new BMap.InfoWindow(`
        <div style="padding: 5px;">
          <h4 style="margin: 0 0 5px 0;">${t.plateNo}</h4>
          <p style="margin: 0;">状态: ${M(t.status)}</p>
        </div>
      `);n.addEventListener("click",()=>{o.openInfoWindow(u,i)})}))},R=()=>{r=lt(document.getElementById("dispatch-chart")),k()},k=()=>{if(!r)return;const l={title:{text:"车辆使用统计",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:"车辆状态",type:"pie",radius:"50%",data:[{value:d.value.idleVehicles,name:"空闲"},{value:d.value.busyVehicles,name:"使用中"},{value:d.value.offlineVehicles,name:"离线"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};r.setOption(l)};let I=null;G(()=>{H(()=>{W(),R(),N(),I=setInterval(()=>{N()},3e4)})}),X(()=>{I&&clearInterval(I),o&&(o.clearOverlays(),o=null),r&&(r.dispose(),r=null),window.removeEventListener("resize",A)});const A=()=>{r&&r.resize(),o&&o.reset()};return window.addEventListener("resize",A),(l,t)=>{const i=c("el-icon"),n=c("el-card"),u=c("el-col"),p=c("el-row"),_=c("el-button"),Y=c("el-button-group"),y=c("el-table-column"),Z=c("el-tag"),j=c("el-table"),x=q("loading");return b(),V("div",ct,[e(p,{gutter:20,class:"stats-row"},{default:s(()=>[e(u,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[a("div",dt,[a("div",rt,[e(i,null,{default:s(()=>[e(C(tt))]),_:1})]),a("div",ut,[a("div",pt,h(d.value.totalVehicles),1),t[0]||(t[0]=a("div",{class:"stat-label"},"总车辆数",-1))])])]),_:1})]),_:1}),e(u,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[a("div",_t,[a("div",ft,[e(i,null,{default:s(()=>[e(C(et))]),_:1})]),a("div",vt,[a("div",ht,h(d.value.idleVehicles),1),t[1]||(t[1]=a("div",{class:"stat-label"},"空闲车辆",-1))])])]),_:1})]),_:1}),e(u,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[a("div",mt,[a("div",gt,[e(i,null,{default:s(()=>[e(C(st))]),_:1})]),a("div",wt,[a("div",yt,h(d.value.busyVehicles),1),t[2]||(t[2]=a("div",{class:"stat-label"},"使用中",-1))])])]),_:1})]),_:1}),e(u,{span:6},{default:s(()=>[e(n,{class:"stat-card"},{default:s(()=>[a("div",bt,[a("div",Ct,[e(i,null,{default:s(()=>[e(C(at))]),_:1})]),a("div",Et,[a("div",Mt,h(d.value.offlineVehicles),1),t[3]||(t[3]=a("div",{class:"stat-label"},"离线车辆",-1))])])]),_:1})]),_:1})]),_:1}),e(p,{gutter:20,class:"main-row"},{default:s(()=>[e(u,{span:16},{default:s(()=>[e(n,{class:"map-card"},{header:s(()=>[a("div",Nt,[t[6]||(t[6]=a("span",null,"车辆实时位置",-1)),e(Y,null,{default:s(()=>[e(_,{size:"small",onClick:$},{default:s(()=>[...t[4]||(t[4]=[E("刷新",-1)])]),_:1}),e(_,{size:"small",onClick:U},{default:s(()=>[...t[5]||(t[5]=[E("全部显示",-1)])]),_:1})]),_:1})])]),default:s(()=>[D((b(),V("div",It,[w.value?J("",!0):(b(),V("p",Vt,"正在加载地图..."))])),[[x,F.value]])]),_:1})]),_:1}),e(u,{span:8},{default:s(()=>[e(n,{class:"status-card"},{header:s(()=>[...t[7]||(t[7]=[a("span",null,"车辆状态列表",-1)])]),default:s(()=>[D((b(),K(j,{data:g.value,height:"400",onRowClick:O},{default:s(()=>[e(y,{prop:"plateNo",label:"车牌号"}),e(y,{prop:"driverName",label:"驾驶员"}),e(y,{prop:"status",label:"状态"},{default:s(f=>[e(Z,{type:z(f.row.status)},{default:s(()=>[E(h(M(f.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{label:"操作",width:"80"},{default:s(f=>[e(_,{size:"small",onClick:Q(kt=>T(f.row),["stop"]),disabled:f.row.status!=="IDLE"},{default:s(()=>[...t[8]||(t[8]=[E(" 派车 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[x,S.value]])]),_:1})]),_:1})]),_:1}),e(n,{class:"chart-card"},{header:s(()=>[...t[9]||(t[9]=[a("span",null,"调度统计",-1)])]),default:s(()=>[t[10]||(t[10]=a("div",{class:"chart-container"},[a("div",{id:"dispatch-chart",style:{width:"100%",height:"300px"}})],-1))]),_:1})])}}}),Dt=P(Bt,[["__scopeId","data-v-cd6bf9fa"]]);export{Dt as default};
