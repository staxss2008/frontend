import{_ as ae,r as v,h as te,b as d,i as oe,o as h,c as ne,d as e,w as t,e as C,g as c,f as ue,m as se,n as de,t as ie,E as g,q as I}from"./main-5d00e0ed.js";import{g as re,u as pe,a as ve,b as me,d as ce}from"./vehicle-30f80322.js";import{c as fe}from"./maintenance-5224a0da.js";const be={class:"vehicle-list"},_e={class:"card-header"},ge={class:"dialog-footer"},ye={__name:"List",setup(Ne){const y=v(!1),T=v([]),D=v(0),s=v(null),b=v(!1),N=v(""),V=v(!1),u=v({page:1,size:10,plateNo:void 0,status:void 0}),n=v({id:void 0,plateNo:"",vehicleType:"",brand:"",model:"",color:"",seats:5,fuelType:"",buyDate:"",gpsDeviceId:""}),k={plateNo:[{required:!0,message:"请输入车牌号",trigger:"blur"}],vehicleType:[{required:!0,message:"请输入车辆类型",trigger:"blur"}]},E=v(null),f=async()=>{y.value=!0;try{const a=await re(u.value.page,u.value.size,u.value.plateNo,u.value.status);T.value=a.data.list,D.value=a.data.total}catch(a){console.error(a)}finally{y.value=!1}},w=()=>{u.value.page=1,f()},A=()=>{u.value={page:1,size:10,plateNo:void 0,status:void 0},w()},B=a=>{u.value.size=a,f()},L=a=>{u.value.page=a,f()},M=()=>{N.value="新增车辆",V.value=!1,b.value=!0},z=a=>{N.value="编辑车辆",V.value=!0,n.value={...a},b.value=!0},R=async(a,l)=>{try{if(await I.confirm(`确定要将车辆 ${a.plateNo} 的状态更新为 ${S(l)} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),l==="MAINTENANCE"){await I.confirm(`确定要将车辆 ${a.plateNo} 设为维修状态吗？这将在维修保养中创建一条维修记录。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r={vehicleId:a.id,type:"MAINTENANCE",date:new Date().toISOString(),content:"车辆维修",mileage:0,cost:0};await fe(r),g.success("已创建维修记录，车辆状态已更新为维修中")}else await me(a.id,l),g.success("状态更新成功");f()}catch(r){r!=="cancel"&&g.error("状态更新失败")}},F=async a=>{try{await I.confirm(`确定要删除车辆 ${a.plateNo} 吗？删除后将无法恢复。`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ce(a.id),g.success("删除成功"),f()}catch(l){l!=="cancel"&&g.error("删除失败")}},Y=async()=>{await E.value.validate(a=>{a&&(V.value?pe(n.value.id,n.value).then(()=>{g.success("修改成功"),b.value=!1,f()}):ve(n.value).then(()=>{g.success("新增成功"),b.value=!1,f()}))})},O=()=>{var a;(a=E.value)==null||a.resetFields()},$=a=>({IDLE:"success",IN_USE:"primary",BUSY:"warning",OFFLINE:"info",MAINTENANCE:"danger"})[a]||"info",S=a=>({IDLE:"空闲",IN_USE:"已指派",BUSY:"使用中",OFFLINE:"离线",MAINTENANCE:"维修中"})[a]||"未知",q=a=>{s.value=a},P=({row:a})=>s.value&&s.value.id===a.id?"selected-row":"",G=()=>{s.value&&z(s.value)},K=()=>{s.value&&R(s.value,"MAINTENANCE")},Q=()=>{s.value&&F(s.value)};return te(()=>{f()}),(a,l)=>{const r=d("el-button"),_=d("el-input"),i=d("el-form-item"),m=d("el-option"),U=d("el-select"),x=d("el-form"),p=d("el-table-column"),j=d("el-tag"),H=d("el-table"),J=d("el-pagination"),W=d("el-card"),X=d("el-input-number"),Z=d("el-date-picker"),ee=d("el-dialog"),le=oe("loading");return h(),ne("div",be,[e(W,null,{header:t(()=>[C("div",_e,[l[16]||(l[16]=C("h3",null,"车辆档案管理",-1)),e(r,{type:"primary",onClick:M},{default:t(()=>[...l[15]||(l[15]=[c("新增车辆",-1)])]),_:1})])]),default:t(()=>[e(x,{model:u.value,inline:""},{default:t(()=>[e(i,{label:"车牌号"},{default:t(()=>[e(_,{modelValue:u.value.plateNo,"onUpdate:modelValue":l[0]||(l[0]=o=>u.value.plateNo=o),placeholder:"请输入车牌号",clearable:"",onKeyup:ue(w,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"状态"},{default:t(()=>[e(U,{modelValue:u.value.status,"onUpdate:modelValue":l[1]||(l[1]=o=>u.value.status=o),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(m,{label:"空闲",value:"IDLE"}),e(m,{label:"已指派",value:"IN_USE"}),e(m,{label:"使用中",value:"BUSY"}),e(m,{label:"维修中",value:"MAINTENANCE"}),e(m,{label:"离线",value:"OFFLINE"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(r,{type:"primary",onClick:w},{default:t(()=>[...l[17]||(l[17]=[c("搜索",-1)])]),_:1}),e(r,{onClick:A},{default:t(()=>[...l[18]||(l[18]=[c("重置",-1)])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(r,{type:"primary",onClick:G,disabled:!s.value},{default:t(()=>[...l[19]||(l[19]=[c(" 编辑 ",-1)])]),_:1},8,["disabled"]),e(r,{type:"warning",onClick:K,disabled:!s.value||s.value.status==="MAINTENANCE"||s.value.status==="IN_USE"},{default:t(()=>[...l[20]||(l[20]=[c(" 维修 ",-1)])]),_:1},8,["disabled"]),e(r,{type:"danger",onClick:Q,disabled:!s.value||s.value.status==="IN_USE"},{default:t(()=>[...l[21]||(l[21]=[c(" 删除 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),se((h(),de(H,{data:T.value,onRowClick:q,"row-class-name":P,style:{width:"100%"}},{default:t(()=>[e(p,{prop:"id",label:"ID",width:"80"}),e(p,{prop:"plateNo",label:"车牌号",width:"120"}),e(p,{prop:"brand",label:"品牌",width:"120"}),e(p,{prop:"model",label:"型号",width:"150"}),e(p,{prop:"vehicleType",label:"类型",width:"100"}),e(p,{prop:"color",label:"颜色",width:"100"}),e(p,{prop:"seats",label:"座位数",width:"100"}),e(p,{prop:"fuelType",label:"燃料类型",width:"120"}),e(p,{prop:"buyDate",label:"购置日期",width:"120"}),e(p,{prop:"status",label:"状态",width:"100"},{default:t(o=>[e(j,{type:$(o.row.status)},{default:t(()=>[c(ie(S(o.row.status)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[le,y.value]]),e(J,{"current-page":u.value.page,"onUpdate:currentPage":l[2]||(l[2]=o=>u.value.page=o),"page-size":u.value.size,"onUpdate:pageSize":l[3]||(l[3]=o=>u.value.size=o),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:L,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"])]),_:1}),e(ee,{title:N.value,modelValue:b.value,"onUpdate:modelValue":l[14]||(l[14]=o=>b.value=o),width:"500px",onClose:O},{footer:t(()=>[C("div",ge,[e(r,{onClick:l[13]||(l[13]=o=>b.value=!1)},{default:t(()=>[...l[22]||(l[22]=[c("取 消",-1)])]),_:1}),e(r,{type:"primary",onClick:Y},{default:t(()=>[...l[23]||(l[23]=[c("确 定",-1)])]),_:1})])]),default:t(()=>[e(x,{model:n.value,rules:k,ref_key:"formRef",ref:E,"label-width":"100px"},{default:t(()=>[e(i,{label:"车牌号",prop:"plateNo"},{default:t(()=>[e(_,{modelValue:n.value.plateNo,"onUpdate:modelValue":l[4]||(l[4]=o=>n.value.plateNo=o),disabled:!!n.value.id},null,8,["modelValue","disabled"])]),_:1}),e(i,{label:"车辆类型",prop:"vehicleType"},{default:t(()=>[e(_,{modelValue:n.value.vehicleType,"onUpdate:modelValue":l[5]||(l[5]=o=>n.value.vehicleType=o)},null,8,["modelValue"])]),_:1}),e(i,{label:"品牌"},{default:t(()=>[e(_,{modelValue:n.value.brand,"onUpdate:modelValue":l[6]||(l[6]=o=>n.value.brand=o)},null,8,["modelValue"])]),_:1}),e(i,{label:"型号"},{default:t(()=>[e(_,{modelValue:n.value.model,"onUpdate:modelValue":l[7]||(l[7]=o=>n.value.model=o)},null,8,["modelValue"])]),_:1}),e(i,{label:"颜色"},{default:t(()=>[e(_,{modelValue:n.value.color,"onUpdate:modelValue":l[8]||(l[8]=o=>n.value.color=o)},null,8,["modelValue"])]),_:1}),e(i,{label:"座位数"},{default:t(()=>[e(X,{modelValue:n.value.seats,"onUpdate:modelValue":l[9]||(l[9]=o=>n.value.seats=o),min:1,max:100},null,8,["modelValue"])]),_:1}),e(i,{label:"燃料类型"},{default:t(()=>[e(U,{modelValue:n.value.fuelType,"onUpdate:modelValue":l[10]||(l[10]=o=>n.value.fuelType=o),placeholder:"请选择燃料类型"},{default:t(()=>[e(m,{label:"汽油",value:"GASOLINE"}),e(m,{label:"柴油",value:"DIESEL"}),e(m,{label:"电动",value:"ELECTRIC"}),e(m,{label:"混合动力",value:"HYBRID"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"购置日期"},{default:t(()=>[e(Z,{modelValue:n.value.buyDate,"onUpdate:modelValue":l[11]||(l[11]=o=>n.value.buyDate=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日期"},null,8,["modelValue"])]),_:1}),e(i,{label:"GPS设备ID"},{default:t(()=>[e(_,{modelValue:n.value.gpsDeviceId,"onUpdate:modelValue":l[12]||(l[12]=o=>n.value.gpsDeviceId=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},Ce=ae(ye,[["__scopeId","data-v-f036757a"]]);export{Ce as default};
